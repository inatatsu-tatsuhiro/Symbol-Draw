{"version":3,"sources":["components/elements/Button/index.tsx","components/utils/Centering/index.tsx","features/connect/Presenter.tsx","features/connect/index.tsx","libs/Symbol/ImageIO.ts"],"names":["Component","text","onClick","fill","FButton","variant","SButton","styled","Button","Color","accent","sky","addAlpha","direction","nowrap","vertical","holizontal","width","height","items","children","Style","wrap","props","apiEndpoint","epochAdjustment","MPage","txHashRef","useRef","mosaicRef","checkRef","useState","mosaicId","setMosaicId","illustMosaic","setIllustMosaic","cx","usePrikey","Root","Centering","Spacer","margin","TextField","inputRef","Wrapper","Box","sx","flexGrow","current","undefined","pk","prikey","acc","Account","createFromPrivateKey","key","KeyGenerator","generateUInt64Key","mid","value","metadataTransaction","MosaicMetadataTransaction","create","Deadline","address","MosaicId","length","aggregateTransaction","AggregateTransaction","createComplete","toAggregate","publicAccount","UInt64","fromUint","signedTx","sign","RepositoryFactoryHttp","createTransactionRepository","announce","subscribe","x","console","log","err","error","metadataHttp","createMetadataRepository","searchCriteria","targetId","metadataType","MetadataType","Mosaic","search","metadataEntries","pageSize","pageNumber","data","forEach","entry","metadataEntry","scopedMetadataKey","toHex","getFile","then","MosaicCard","Text","Img","src","alt","Container","G_HASH","NODE","EPOCH","hash","a","Promise","resolve","reject","checkConfirmed","tx","TransferTransaction","h","JSON","parse","message","payload","innerTxJoin","catch","timer","setInterval","checkUnConfirmed","setTimeout","clearInterval","transactionHttp","res","rej","getTransaction","TransactionGroup","Unconfirmed","toPromise","Confirmed","repositoryFactory","agtx","innerTxs","innerTransactions","inTx","saveFile","base64img","gameMode","previousHash","signer","NetworkType","TEST_NET","Address","createFromRawAddress","array","MSG_SIZE","i","Math","floor","arr","slice","push","txs","agtxs","hashes","PlainMessage","stringify","version","name","mode","join","substr","st"],"mappings":"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","file":"static/js/8.2fe54e95.chunk.js","sourcesContent":["import React from 'react'\nimport styled from '@emotion/styled'\n\nimport { Button } from '@mui/material'\nimport Color, { addAlpha } from '../../../utils/Color'\n\nexport interface Props {\n  text: string\n  onClick: () => void\n  fill?: boolean\n}\n\nconst Component: React.VFC<Props> = ({ text, onClick, fill = false }) => {\n  if (fill) {\n    return (\n      <FButton variant=\"outlined\" onClick={onClick}>\n        {text}\n      </FButton>\n    )\n  }\n\n  return (\n    <SButton variant=\"outlined\" onClick={onClick}>\n      {text}\n    </SButton>\n  )\n}\n\nexport default Component\n\nconst FButton = styled(Button)`\n  color: white !important;\n  background: ${Color.accent.sky} !important;\n  border-color: ${Color.accent.sky} !important;\n  font-weight: 700;\n`\nconst SButton = styled(Button)`\n  color: ${Color.accent.sky} !important;\n  border-color: ${Color.accent.sky} !important;\n\n  :hover {\n    border-color: ${Color.accent.sky} !important;\n    background-color: ${addAlpha(Color.accent.sky, 0.04)} !important;\n  }\n`\n","import * as React from 'react'\nimport styled from '@emotion/styled'\n\nexport type CenteringProps = {\n  direction?: string\n  nowrap?: boolean\n  vertical?: string\n  holizontal?: string\n  width?: string\n  height?: string\n  items?: string\n  children?: React.ReactNode\n}\n\nconst Component: React.VFC<CenteringProps> = ({\n  direction = 'row',\n  nowrap = false,\n  vertical = 'center',\n  holizontal = 'center',\n  width = '100%',\n  height = '100%',\n  items = 'normal',\n  children,\n}) => {\n  return (\n    <Style\n      direction={direction}\n      holizontal={holizontal}\n      vertical={vertical}\n      width={width}\n      height={height}\n      items={items}\n      wrap={nowrap ? 'nowrap' : 'wrap'}>\n      {children}\n    </Style>\n  )\n}\nexport default Component\n\nconst Style = styled('div')<{\n  direction: string\n  wrap: string\n  vertical: string\n  holizontal: string\n  width: string\n  height: string\n  items: string\n}>`\n  display: flex;\n  width: ${(props) => props.width};\n  height: ${(props) => props.height};\n  flex-direction: ${(props) => props.direction};\n  ${(props) => props.wrap && 'flex-wrap: wrap'};\n  justify-content: ${(props) => props.holizontal};\n  align-content: ${(props) => props.vertical};\n  align-items: ${(props) => props.items};\n`\n","import { Box } from '@mui/material'\nimport styled from '@emotion/styled'\n\nimport React, { useRef, useState } from 'react'\nimport TextField from '../../components/elements/TextField'\nimport Button from '../../components/elements/Button'\n\nimport Centering from '../../components/utils/Centering'\nimport Spacer from '../../components/utils/Spacer'\nimport {\n  Account,\n  AggregateTransaction,\n  Deadline,\n  KeyGenerator,\n  Metadata,\n  MetadataType,\n  MosaicId,\n  MosaicMetadataTransaction,\n  RepositoryFactoryHttp,\n  UInt64,\n  Page,\n} from 'symbol-sdk'\nimport { getFile } from '../../libs/Symbol/ImageIO'\nimport { usePrikey } from '../../utils/PrikeyContext'\n\nconst apiEndpoint = 'https://sym-test-01.opening-line.jp:3001' //config.SYMBOL_API_ENDPOINT\nconst generationHash =\n  '7FCCD304802016BEBBCD342A332F91FF1F3BB5E902988B352697BE245F48E836' //config.GENERATION_HASH_SEED\n// const feeMultiplier = 200 //config.FEE_MULTIPLIER\nconst epochAdjustment = 1637848847 //config.EPOCH_ADJUSTMENT\nconst networkType = 152 //config.NETWORK_TYPE\n\nconst MPage: React.VFC = () => {\n  const txHashRef = useRef<HTMLInputElement>(null)\n  const mosaicRef = useRef<HTMLInputElement>(null)\n  const checkRef = useRef<HTMLInputElement>(null)\n\n  const [mosaicId, setMosaicId] = useState('')\n\n  const [illustMosaic, setIllustMosaic] = useState('')\n  const check = () => {\n    if (checkRef === null || checkRef.current === null) {\n      return\n    }\n    const mid = new MosaicId(checkRef.current.value)\n    console.log('mid', mid)\n    setMosaicId(checkRef.current.value)\n\n    const repositoryFactory = new RepositoryFactoryHttp(apiEndpoint)\n    const metadataHttp = repositoryFactory.createMetadataRepository()\n\n    const searchCriteria = {\n      targetId: mid,\n      metadataType: MetadataType.Mosaic,\n    }\n    metadataHttp.search(searchCriteria).subscribe(\n      (metadataEntries: Page<Metadata>) => {\n        if (metadataEntries.pageSize > 0) {\n          console.log('Page', metadataEntries.pageNumber)\n          metadataEntries.data.forEach((entry: Metadata) => {\n            const metadataEntry = entry.metadataEntry\n            console.log('Key:\\t', metadataEntry.scopedMetadataKey.toHex())\n            if (\n              metadataEntry.scopedMetadataKey.toHex() === 'F5CC2D09ED048388'\n            ) {\n              console.log('Value:\\t', metadataEntry.value)\n              getFile(metadataEntry.value).then((data) => {\n                setIllustMosaic(data)\n              })\n            }\n          })\n        } else {\n          console.log('\\n The mosaic does not have metadata entries assigned.')\n        }\n      },\n      (err) => console.log(err)\n    )\n  }\n  const cx = usePrikey()\n  const link = () => {\n    if (\n      mosaicRef === null ||\n      mosaicRef.current === null ||\n      txHashRef === null ||\n      txHashRef.current === null\n    ) {\n      return\n    }\n\n    if (cx === undefined) return\n\n    const pk = cx.prikey\n\n    const acc = Account.createFromPrivateKey(pk, networkType)\n\n    const key = KeyGenerator.generateUInt64Key('CERT')\n    const mid = mosaicRef.current.value\n    const value = txHashRef.current.value\n\n    const metadataTransaction = MosaicMetadataTransaction.create(\n      Deadline.create(epochAdjustment),\n      acc.address,\n      key,\n      new MosaicId(mid),\n      value.length,\n      value,\n      networkType\n    )\n\n    const aggregateTransaction = AggregateTransaction.createComplete(\n      Deadline.create(epochAdjustment),\n      [metadataTransaction.toAggregate(acc.publicAccount)],\n      networkType,\n      [],\n      UInt64.fromUint(2000000)\n    )\n\n    const signedTx = acc.sign(aggregateTransaction, generationHash)\n\n    const repositoryFactory = new RepositoryFactoryHttp(apiEndpoint)\n    const transactionHttp = repositoryFactory.createTransactionRepository()\n\n    transactionHttp.announce(signedTx).subscribe(\n      (x) => console.log(x),\n      (err) => console.error(err)\n    )\n  }\n  return (\n    <Root>\n      <Centering direction=\"column\" holizontal=\"start\">\n        <Spacer margin=\"8px\"></Spacer>\n        <TextField text=\"TxHash\" inputRef={txHashRef} />\n        <Spacer margin=\"8px\"></Spacer>\n        <TextField text=\"MosaicID\" inputRef={mosaicRef} />\n        <Wrapper>\n          <Box sx={{ flexGrow: 1 }} />\n          <Spacer margin=\"8px\">\n            <Button text=\"LINK\" onClick={link} />\n          </Spacer>\n        </Wrapper>\n        <Spacer margin=\"32px\"></Spacer>\n        <TextField text=\"MosaicID\" inputRef={checkRef} />\n        <Wrapper>\n          <Box sx={{ flexGrow: 1 }} />\n          <Spacer margin=\"8px\">\n            <Button text=\"CHECK\" onClick={check} />\n          </Spacer>\n        </Wrapper>\n      </Centering>\n      {illustMosaic !== '' && (\n        <MosaicCard>\n          <Text>MosaicID: {mosaicId}</Text>\n          <Img\n            src={illustMosaic}\n            width=\"500px\"\n            height=\"500px\"\n            alt=\"ilustmosaic\"\n          />\n        </MosaicCard>\n      )}\n    </Root>\n  )\n}\n\nexport default MPage\nconst Wrapper = styled('div')`\n  display: flex;\n`\n\nconst Root = styled('div')`\n  display: flex;\n  flex-direction: column;\n`\n\nconst MosaicCard = styled('div')`\n  border: 1px solid #b429f9;\n  border-radius: 16px;\n  margin: 16px;\n  padding: 16px;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n`\n\nconst Text = styled('div')`\n  font-size: 48px;\n`\n\nconst Img = styled('img')`\n  border: 1px solid black;\n`\n","import React from 'react'\nimport Page from './Presenter'\n\nconst Container: React.VFC = () => {\n  return <Page />\n}\n\nexport default Container\n","import {\n  Account,\n  AggregateTransaction,\n  Deadline,\n  NetworkType,\n  TransferTransaction,\n  UInt64,\n  RepositoryFactoryHttp,\n  PlainMessage,\n  TransactionGroup,\n  Transaction,\n  Address,\n} from 'symbol-sdk'\n\nconst G_HASH =\n  '7FCCD304802016BEBBCD342A332F91FF1F3BB5E902988B352697BE245F48E836'\nconst NODE = 'https://sym-test-01.opening-line.jp:3001'\nconst EPOCH = 1637848847\n\nexport const getFile = async (hash: string): Promise<string> => {\n  return new Promise((resolve, reject) => {\n    checkConfirmed(hash)\n      .then((tx) => {\n        if (tx instanceof TransferTransaction) {\n          const h: string = JSON.parse(tx.message.payload).data\n          resolve(innerTxJoin(h))\n        }\n      })\n      .catch(() => {\n        const timer = setInterval(() => {\n          checkUnConfirmed(hash)\n            .then(() => {\n              setTimeout(() => {\n                checkConfirmed(hash)\n                  .then((tx) => {\n                    clearInterval(timer)\n                    if (tx instanceof TransferTransaction) {\n                      const h: string = JSON.parse(tx.message.payload).data\n                      resolve(innerTxJoin(h))\n                    }\n                  })\n                  .catch(() => {\n                    reject('404')\n                  })\n              }, 1000)\n            })\n            .catch(() => {\n              console.log('loading')\n            })\n        }, 1000)\n      })\n  })\n}\n\nconst checkUnConfirmed = (hash: string): Promise<void> => {\n  const repositoryFactory = new RepositoryFactoryHttp(NODE)\n  const transactionHttp = repositoryFactory.createTransactionRepository()\n  return new Promise((res, rej) => {\n    transactionHttp\n      .getTransaction(hash, TransactionGroup.Unconfirmed)\n      .toPromise()\n      .then(() => {\n        rej()\n      })\n      .catch(() => {\n        res()\n      })\n  })\n}\n\nconst checkConfirmed = (hash: string): Promise<Transaction> => {\n  const repositoryFactory = new RepositoryFactoryHttp(NODE)\n  const transactionHttp = repositoryFactory.createTransactionRepository()\n  return new Promise((res, rej) => {\n    transactionHttp\n      .getTransaction(hash, TransactionGroup.Confirmed)\n      .toPromise()\n      .then((tx: Transaction) => {\n        res(tx)\n      })\n      .catch(() => {\n        rej()\n      })\n  })\n}\nconst innerTxJoin = async (hash: string): Promise<string> => {\n  const repositoryFactory = new RepositoryFactoryHttp(NODE)\n  const transactionHttp = repositoryFactory.createTransactionRepository()\n  let data = ''\n\n  return new Promise((resolve) => {\n    transactionHttp\n      .getTransaction(hash, TransactionGroup.Confirmed)\n      .toPromise()\n      .then((agtx) => {\n        const innerTxs = (agtx as AggregateTransaction).innerTransactions\n        for (const inTx of innerTxs) {\n          data += (inTx as TransferTransaction).message.payload\n        }\n        resolve(data)\n      })\n  })\n}\n\nexport const saveFile = async (\n  base64img: string,\n  gameMode: string,\n  prikey: string,\n  previousHash: string\n): Promise<string> => {\n  const signer = Account.createFromPrivateKey(prikey, NetworkType.TEST_NET)\n  const acc = Address.createFromRawAddress(\n    'TDEC5VUUAUYHKI2Y45WBDMGODAS42P3PPCTMGUY'\n  )\n  const array: string[] = []\n  const MSG_SIZE = 1023\n  for (let i = 0; i <= Math.floor(base64img.length / MSG_SIZE); i++) {\n    const arr = base64img.slice(i * MSG_SIZE, (i + 1) * MSG_SIZE)\n    array.push(arr)\n  }\n  // console.log('arr', array)\n\n  //===================================================\n\n  const txs = []\n  const agtxs = []\n  const hashes: string[] = []\n  //===================================================\n\n  const repositoryFactory = new RepositoryFactoryHttp(NODE)\n  const transactionHttp = repositoryFactory.createTransactionRepository()\n\n  for (let i = 0; i < array.length; i++) {\n    // console.log(\"row\", array[i]);\n    const inTx = TransferTransaction.create(\n      Deadline.create(EPOCH),\n      acc,\n      [],\n      PlainMessage.create(array[i]),\n      NetworkType.TEST_NET\n    ).toAggregate(signer.publicAccount)\n\n    txs.push(inTx)\n\n    if (i % 100 !== 99 && i !== array.length - 1) {\n      continue\n    }\n\n    const agtx = AggregateTransaction.createComplete(\n      Deadline.create(EPOCH),\n      txs,\n      NetworkType.TEST_NET,\n      [],\n      UInt64.fromUint(10000000)\n    )\n\n    const signedTx = signer.sign(agtx, G_HASH)\n\n    transactionHttp.announce(signedTx).subscribe(\n      (x) => console.log(x),\n      (err) => console.error(err)\n    )\n    agtxs.push(signedTx)\n    hashes.push(signedTx.hash)\n\n    console.log('a', signedTx)\n  }\n\n  return new Promise((resolve) => {\n    setTimeout(() => {\n      const data = JSON.stringify({\n        version: 1,\n        name: 'symbol-draw',\n        mode: gameMode,\n        previousHash: previousHash,\n        data: hashes.join(','),\n      })\n\n      const a = []\n      for (let i = 0; i <= Math.floor(data.length / MSG_SIZE); i++) {\n        a.push(data.substr(i * MSG_SIZE, MSG_SIZE))\n      }\n      const tx = TransferTransaction.create(\n        Deadline.create(EPOCH),\n        acc,\n        [],\n        PlainMessage.create(data),\n        NetworkType.TEST_NET,\n        UInt64.fromUint(2000000)\n      )\n\n      const st = signer.sign(tx, G_HASH)\n\n      transactionHttp.announce(st).subscribe(\n        (x) => console.log(x),\n        (err) => console.error(err)\n      )\n      resolve(st.hash)\n    }, 1000)\n  })\n}\n"],"sourceRoot":""}